<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	font-weight: bold;
	color: #0000FF;
}
.sc3 {
	color: #8000FF;
}
.sc4 {
	color: #0080FF;
}
.sc5 {
	color: #FF8000;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc8 {
	font-weight: bold;
	color: #000080;
}
.sc9 {
}
.sc10 {
	color: #804000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">## Setup</span><span class="sc0">
</span><span class="sc3">setwd</span><span class="sc8">(</span><span class="sc6">"/Users/peterjmyers/Documents/Personal/Data Science/Machine Learning/ISL/R Labs"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">getwd</span><span class="sc8">()</span><span class="sc0">
</span><span class="sc3">source</span><span class="sc8">(</span><span class="sc6">"file.r"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># runs r file</span><span class="sc0">
</span><span class="sc3">rm</span><span class="sc8">(</span><span class="sc3">list</span><span class="sc8">=</span><span class="sc3">ls</span><span class="sc8">())</span><span class="sc0"> </span><span class="sc1"># Remove all variables</span><span class="sc0">
</span><span class="sc3">rm</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Remove x and y variables</span><span class="sc0">
</span><span class="sc3">ls</span><span class="sc8">()</span><span class="sc0"> </span><span class="sc1"># List the variables</span><span class="sc0">

</span><span class="sc1">## Some commands</span><span class="sc0">
</span><span class="sc1"># funcname(input1, input2) to use functions</span><span class="sc0">
</span><span class="sc1"># c() to concatenate</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc0"> </span><span class="sc8">&lt;-</span><span class="sc0"> </span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">5</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">y</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">length</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">+</span><span class="sc9">y</span><span class="sc0">
</span><span class="sc8">?</span><span class="sc3">matrix</span><span class="sc0"> </span><span class="sc1"># see help page</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">=</span><span class="sc3">matrix</span><span class="sc8">(</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc8">)</span><span class="sc0">, </span><span class="sc3">nrow</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc0">, </span><span class="sc3">ncol</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc0">
</span><span class="sc3">sqrt</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">^</span><span class="sc5">2</span><span class="sc0">

</span><span class="sc1">## cor(), rnorm(), and set.seed()</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">=</span><span class="sc3">rnorm</span><span class="sc8">(</span><span class="sc5">50</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">y</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc8">+</span><span class="sc3">rnorm</span><span class="sc8">(</span><span class="sc5">50</span><span class="sc0">,</span><span class="sc3">mean</span><span class="sc8">=</span><span class="sc5">50</span><span class="sc0">,</span><span class="sc3">sd</span><span class="sc8">=</span><span class="sc5">.1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">cor</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1303</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## mean(), var(), and sd()</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">y</span><span class="sc8">=</span><span class="sc3">rnorm</span><span class="sc8">(</span><span class="sc5">100</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">sqrt</span><span class="sc8">(</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">sd</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## plot(), pdf(), and jpeg()</span><span class="sc0">
</span><span class="sc8">?</span><span class="sc3">plot</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">=</span><span class="sc3">rnorm</span><span class="sc8">(</span><span class="sc5">100</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">y</span><span class="sc8">=</span><span class="sc3">rnorm</span><span class="sc8">(</span><span class="sc5">100</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"p"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># points</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"l"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># lines</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"b"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># both</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"c"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># lines alone of b</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"o"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># overplotted</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"h"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># histogram</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"s"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># stair steps</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"S"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># other steps</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"n"</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"this is the x-axis"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"this is the y-axis"</span><span class="sc0">,</span><span class="sc9">main</span><span class="sc8">=</span><span class="sc6">"Plot of X vs Y"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># no plotting</span><span class="sc0">
</span><span class="sc3">pdf</span><span class="sc8">(</span><span class="sc6">"Figure.pdf"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"green"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">dev.off</span><span class="sc8">()</span><span class="sc0">

</span><span class="sc1">## seq(), contour(), image(), and persp()</span><span class="sc0">
</span><span class="sc3">seq</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">10</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">=</span><span class="sc3">seq</span><span class="sc8">(-</span><span class="sc3">pi</span><span class="sc0">,</span><span class="sc3">pi</span><span class="sc0">,</span><span class="sc3">length</span><span class="sc8">=</span><span class="sc5">50</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc8">?</span><span class="sc3">contour</span><span class="sc0">
</span><span class="sc9">y</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc0">
</span><span class="sc9">f</span><span class="sc8">=</span><span class="sc3">outer</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc2">function</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">)</span><span class="sc3">cos</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">)/(</span><span class="sc5">1</span><span class="sc8">+</span><span class="sc9">x</span><span class="sc8">^</span><span class="sc5">2</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">contour</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">f</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">contour</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">f</span><span class="sc0">,</span><span class="sc3">nlevels</span><span class="sc8">=</span><span class="sc5">45</span><span class="sc0">,</span><span class="sc9">add</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">fa</span><span class="sc8">=(</span><span class="sc9">f</span><span class="sc8">-</span><span class="sc3">t</span><span class="sc8">(</span><span class="sc9">f</span><span class="sc8">))/</span><span class="sc5">2</span><span class="sc0">
</span><span class="sc3">contour</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc0">,</span><span class="sc3">nlevels</span><span class="sc8">=</span><span class="sc5">15</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">image</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">persp</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">persp</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc0">,</span><span class="sc9">theta</span><span class="sc8">=</span><span class="sc5">30</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">persp</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc0">,</span><span class="sc9">theta</span><span class="sc8">=</span><span class="sc5">30</span><span class="sc0">,</span><span class="sc9">phi</span><span class="sc8">=</span><span class="sc5">20</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">persp</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc0">,</span><span class="sc9">theta</span><span class="sc8">=</span><span class="sc5">30</span><span class="sc0">,</span><span class="sc9">phi</span><span class="sc8">=</span><span class="sc5">70</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">persp</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">fa</span><span class="sc0">,</span><span class="sc9">theta</span><span class="sc8">=</span><span class="sc5">30</span><span class="sc0">,</span><span class="sc9">phi</span><span class="sc8">=</span><span class="sc5">40</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Indexing data</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">=</span><span class="sc3">matrix</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">16</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc8">)]</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">3</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">:</span><span class="sc5">4</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">2</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">A</span><span class="sc8">[-</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">A</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Loading data</span><span class="sc0">
</span><span class="sc9">Auto</span><span class="sc8">=</span><span class="sc9">read.table</span><span class="sc8">(</span><span class="sc6">"Auto.txt"</span><span class="sc0">,</span><span class="sc9">header</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc0">,</span><span class="sc9">na.strings</span><span class="sc8">=</span><span class="sc6">"?"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Read in the data</span><span class="sc0">
</span><span class="sc1"># fix(Auto) lets you update the data.frame was a spreadsheet</span><span class="sc0">
</span><span class="sc9">Auto</span><span class="sc8">=</span><span class="sc9">na.omit</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># one way to remove missing data</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Get column names</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Get observation count and column count</span><span class="sc0">
</span><span class="sc1"># write.table() # Writes the output to a file</span><span class="sc0">

</span><span class="sc1">## Using the data</span><span class="sc0">
</span><span class="sc3">attach</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># optionally can do plot(Auto$cylinders, Auto$mpg) even if not attached</span><span class="sc0">
</span><span class="sc9">cylinders</span><span class="sc8">=</span><span class="sc9">as.factor</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Cast a column to be a factor</span><span class="sc0">
</span><span class="sc1"># Plot with categorical x-axis data will be a boxplot by default</span><span class="sc0">
</span><span class="sc1"># Boxplot:</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc0">, </span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc0">, </span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc0">, </span><span class="sc9">varwidth</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc0">, </span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc0">, </span><span class="sc9">varwidth</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc0">, </span><span class="sc9">horizontal</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cylinders</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc0">, </span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc0">, </span><span class="sc9">varwidth</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc0">, </span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"cylinders"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"MPG"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># Histogram:</span><span class="sc0">
</span><span class="sc3">hist</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">hist</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">hist</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc9">breaks</span><span class="sc8">=</span><span class="sc5">15</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># Scatterplot:</span><span class="sc0">
</span><span class="sc3">pairs</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">pairs</span><span class="sc8">(~</span><span class="sc0"> </span><span class="sc9">mpg</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc9">displacement</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc9">horsepower</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc9">weight</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc9">acceleration</span><span class="sc0">, </span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc9">mpg</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">identify</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc0">, </span><span class="sc9">mpg</span><span class="sc0">, </span><span class="sc9">name</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># interactive method for identifying the value for a particular variable for points on a plot</span><span class="sc0">
</span><span class="sc1"># Summaries:</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Summary of each variable in the particular data set</span><span class="sc0">
</span><span class="sc3">fivenum</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># five number summary</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">)</span><span class="sc0">


</span><span class="sc1">## install.packages installs the packages</span><span class="sc0">

</span><span class="sc1">## library loads libraries after installed</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">MASS</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">ISLR</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">car</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Simple Linear Regression</span><span class="sc0">
</span><span class="sc3">fix</span><span class="sc8">(</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc8">?</span><span class="sc9">Boston</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">attach</span><span class="sc8">(</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc9">lstat</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">confint</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc0">,</span><span class="sc9">data.frame</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">5</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc0">,</span><span class="sc5">15</span><span class="sc8">))</span><span class="sc0">,
        </span><span class="sc9">interval</span><span class="sc8">=</span><span class="sc6">"confidence"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc0">,</span><span class="sc9">data.frame</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">5</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc0">,</span><span class="sc5">15</span><span class="sc8">))</span><span class="sc0">, </span><span class="sc1">#wider interval due to epsilons</span><span class="sc0">
        </span><span class="sc9">interval</span><span class="sc8">=</span><span class="sc6">"prediction"</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Plots</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc9">medv</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">abline</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">abline</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc0">,</span><span class="sc9">lwd</span><span class="sc8">=</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">abline</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc0">,</span><span class="sc9">lwd</span><span class="sc8">=</span><span class="sc5">3</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc9">medv</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc9">medv</span><span class="sc0">,</span><span class="sc9">pch</span><span class="sc8">=</span><span class="sc5">20</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc9">medv</span><span class="sc0">,</span><span class="sc9">pch</span><span class="sc8">=</span><span class="sc6">"+"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc9">medv</span><span class="sc0">,</span><span class="sc9">pch</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">20</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">par</span><span class="sc8">(</span><span class="sc9">mfrow</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">, </span><span class="sc3">residuals</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">, </span><span class="sc3">rstudent</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">))</span><span class="sc0">

</span><span class="sc1">## Multiple Linear Regression</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc9">lstat</span><span class="sc8">+</span><span class="sc9">age</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># fit all other columns as predictors</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)$</span><span class="sc9">r.sq</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)$</span><span class="sc9">sig</span><span class="sc0">
</span><span class="sc9">lm.fit1</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc0">.</span><span class="sc8">-</span><span class="sc9">age</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Boston</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># fit all other columns as predictors but one</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit1</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## VIF and hat values</span><span class="sc0">
</span><span class="sc9">vif</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># from library(car)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc3">hatvalues</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc9">which.max</span><span class="sc8">(</span><span class="sc3">hatvalues</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">))</span><span class="sc0">

</span><span class="sc1">## Interaction Terms </span><span class="sc0">
</span><span class="sc1"># lstat:block includes an interaction term</span><span class="sc0">
</span><span class="sc1"># lstat*block includes an interaction term and the individual terms</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc9">lstat</span><span class="sc8">*</span><span class="sc9">age</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Boston</span><span class="sc8">))</span><span class="sc0">

</span><span class="sc1">## Non-linear Transformations of the Predictors</span><span class="sc0">
</span><span class="sc1"># I() is needed because ^ has a special meaning in a formula</span><span class="sc0">
</span><span class="sc9">lm.fit2</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc9">lstat</span><span class="sc8">+</span><span class="sc9">I</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc8">^</span><span class="sc5">2</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit2</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># suggests it is an improved model</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc9">lstat</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">anova</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc0">,</span><span class="sc9">lm.fit2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># anova is a statistical test to see if the model has improved</span><span class="sc0">
</span><span class="sc1"># Null hypothesis: Both models fit the data equally well</span><span class="sc0">
</span><span class="sc1"># Alternative hypothesis: The second model fits the data better</span><span class="sc0">
</span><span class="sc1"># The F value of 135 provides clear evidence that model 2 is far superior to model 1.</span><span class="sc0">

</span><span class="sc1">## Polynomial fit to the fifth power shortcut:</span><span class="sc0">
</span><span class="sc9">lm.fit5</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">medv</span><span class="sc8">~</span><span class="sc3">poly</span><span class="sc8">(</span><span class="sc9">lstat</span><span class="sc0">,</span><span class="sc5">5</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">lm.fit5</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">anova</span><span class="sc8">(</span><span class="sc9">lm.fit2</span><span class="sc0">,</span><span class="sc9">lm.fit5</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Qualitative Predictors</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">Carseats</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">head</span><span class="sc8">(</span><span class="sc9">Carseats</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Carseats</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># dummy variables are made by default for multi-class predictors</span><span class="sc0">
</span><span class="sc3">attach</span><span class="sc8">(</span><span class="sc9">Carseats</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">contrasts</span><span class="sc8">(</span><span class="sc9">ShelveLoc</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># shows the dummy variables R uses</span><span class="sc0">
</span><span class="sc8">?</span><span class="sc3">contrasts</span><span class="sc0">

</span><span class="sc1">## Creating our own functions</span><span class="sc0">
</span><span class="sc9">LoadLibraries</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc2">function</span><span class="sc8">(){</span><span class="sc0">
  </span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">ISLR</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">MASS</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc6">"The libraries have been loaded."</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">

</span><span class="sc9">LoadLibraries</span><span class="sc0">



</span><span class="sc1">## Stock Market Data</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">ISLR</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">head</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">cor</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Error, all predictors must be numeric</span><span class="sc0">
</span><span class="sc3">cor</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc8">-</span><span class="sc5">9</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">attach</span><span class="sc8">(</span><span class="sc9">Smarket</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Logistic Regression</span><span class="sc0">
</span><span class="sc1"># glm() fits generalized linear models</span><span class="sc0">
</span><span class="sc1"># We must pass in argument family=binomial</span><span class="sc0">
</span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">~</span><span class="sc9">Lag1</span><span class="sc8">+</span><span class="sc9">Lag2</span><span class="sc8">+</span><span class="sc9">Lag3</span><span class="sc8">+</span><span class="sc9">Lag4</span><span class="sc8">+</span><span class="sc9">Lag5</span><span class="sc8">+</span><span class="sc9">Volume</span><span class="sc0">,
            </span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Smarket</span><span class="sc0">, </span><span class="sc3">family</span><span class="sc8">=</span><span class="sc3">binomial</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">contrasts</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Up 1, down 0</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># lowest p-value is Lag1</span><span class="sc0">
</span><span class="sc1"># negative coefficient here means up/down, down/up relationship Lag1 vs Direction</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Better than running summary</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc8">)$</span><span class="sc3">coef</span><span class="sc0"> </span><span class="sc1"># More calculations required</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc8">)$</span><span class="sc3">coef</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc8">]</span><span class="sc0"> </span><span class="sc1"># More calculations required</span><span class="sc0">
</span><span class="sc9">glm.probs</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc0">,</span><span class="sc9">Smarket.2005</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"response"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># type="response gives Prob(Y|X)</span><span class="sc0">
</span><span class="sc1"># Without type="response" it gives log-odds for family=binomial</span><span class="sc0">
</span><span class="sc9">glm.probs</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">10</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">contrasts</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># Up 1, down 0</span><span class="sc0">
</span><span class="sc9">glm.pred</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc6">"Down"</span><span class="sc0">,</span><span class="sc5">1250</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.pred</span><span class="sc8">[</span><span class="sc9">glm.probs</span><span class="sc8">&gt;</span><span class="sc5">.5</span><span class="sc8">]=</span><span class="sc6">"Up"</span><span class="sc0">  </span><span class="sc1"># we predict up if higher than 50% prediction probability for Up</span><span class="sc0">
</span><span class="sc3">table</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc0">,</span><span class="sc9">glm.pred</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc0"> </span><span class="sc8">&lt;-</span><span class="sc0"> </span><span class="sc2">function</span><span class="sc8">(</span><span class="sc9">response</span><span class="sc0">,</span><span class="sc9">pred</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
  </span><span class="sc9">diagnosticTable</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">table</span><span class="sc8">(</span><span class="sc9">response</span><span class="sc0">,</span><span class="sc9">pred</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc9">diagnosticTable</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc6">"False Pos. Rate:"</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]/(</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">]+</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]))</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc6">"True Pos. Rate:"</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]/(</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">]+</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]))</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc6">"Pos. Pred. Value:"</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]/(</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]+</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]))</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc6">"Accuracy Rate:"</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">((</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">]+</span><span class="sc9">diagnosticTable</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">])/</span><span class="sc3">sum</span><span class="sc8">(</span><span class="sc9">diagnosticTable</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">

</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">glm.pred</span><span class="sc0">,</span><span class="sc9">Direction</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">glm.pred</span><span class="sc8">==</span><span class="sc9">Direction</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Training and Test Set</span><span class="sc0">
</span><span class="sc9">train</span><span class="sc8">=(</span><span class="sc9">Year</span><span class="sc8">&lt;</span><span class="sc5">2005</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">Smarket.2005</span><span class="sc8">=</span><span class="sc9">Smarket</span><span class="sc8">[!</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Smarket.2005</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">Direction.2005</span><span class="sc8">=</span><span class="sc9">Direction</span><span class="sc8">[!</span><span class="sc9">train</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">Direction.2005</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">~</span><span class="sc9">Lag1</span><span class="sc8">+</span><span class="sc9">Lag2</span><span class="sc8">+</span><span class="sc9">Lag3</span><span class="sc8">+</span><span class="sc9">Lag4</span><span class="sc8">+</span><span class="sc9">Lag5</span><span class="sc8">+</span><span class="sc9">Volume</span><span class="sc0">,
            </span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Smarket</span><span class="sc0">, </span><span class="sc3">family</span><span class="sc8">=</span><span class="sc3">binomial</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1">#Now we check the test set below</span><span class="sc0">
</span><span class="sc9">checkTestSetBinomial</span><span class="sc0"> </span><span class="sc8">&lt;-</span><span class="sc0"> </span><span class="sc2">function</span><span class="sc8">(</span><span class="sc9">fit</span><span class="sc0">,</span><span class="sc9">testSet</span><span class="sc0">,</span><span class="sc9">responseVar</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
  </span><span class="sc9">glm.probs</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">fit</span><span class="sc0">,</span><span class="sc9">testSet</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"response"</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">glm.pred</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc6">"Down"</span><span class="sc0">,</span><span class="sc5">252</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">glm.pred</span><span class="sc8">[</span><span class="sc9">glm.probs</span><span class="sc8">&gt;</span><span class="sc5">.5</span><span class="sc8">]=</span><span class="sc6">"Up"</span><span class="sc0">
  </span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">responseVar</span><span class="sc0">,</span><span class="sc9">glm.pred</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># rate correct: mean(glm.pred==Direction.2005)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc6">"Error Rate:"</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">print</span><span class="sc8">(</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">glm.pred</span><span class="sc8">!=</span><span class="sc9">responseVar</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">

</span><span class="sc9">checkTestSetBinomial</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc0">,</span><span class="sc9">Smarket.2005</span><span class="sc0">,</span><span class="sc9">Direction.2005</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1"># Training with less variables below</span><span class="sc0">
</span><span class="sc9">glm.fit2</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">~</span><span class="sc9">Lag1</span><span class="sc8">+</span><span class="sc9">Lag2</span><span class="sc0">,
            </span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Smarket</span><span class="sc0">, </span><span class="sc3">family</span><span class="sc8">=</span><span class="sc3">binomial</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">checkTestSetBinomial</span><span class="sc8">(</span><span class="sc9">glm.fit2</span><span class="sc0">,</span><span class="sc9">Smarket.2005</span><span class="sc0">,</span><span class="sc9">Direction.2005</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># Predict new data</span><span class="sc0">
</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">glm.fit2</span><span class="sc0">,</span><span class="sc9">newdata</span><span class="sc8">=</span><span class="sc9">data.frame</span><span class="sc8">(</span><span class="sc9">Lag1</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1.2</span><span class="sc0">,</span><span class="sc5">1.5</span><span class="sc8">)</span><span class="sc0">,
                                   </span><span class="sc9">Lag2</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1.1</span><span class="sc0">,</span><span class="sc8">-</span><span class="sc5">0.8</span><span class="sc8">))</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"response"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">anova</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc0">,</span><span class="sc9">glm.fit2</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Linear Discriminant Analysis (LDA)</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">MASS</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lda.fit</span><span class="sc8">=</span><span class="sc9">lda</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">~</span><span class="sc9">Lag1</span><span class="sc8">+</span><span class="sc9">Lag2</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Smarket</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lda.fit</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lda.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lda.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lda.fit</span><span class="sc0">, </span><span class="sc9">Smarket.2005</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lda.pred</span><span class="sc0">
</span><span class="sc1"># Use something like this to predict class only if probability above a threshold like .1 instead of .5</span><span class="sc0">
</span><span class="sc3">length</span><span class="sc8">(</span><span class="sc9">Direction.2005</span><span class="sc8">[</span><span class="sc9">lda.pred</span><span class="sc8">$</span><span class="sc9">posterior</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">]&gt;</span><span class="sc5">.60</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc1"># lda.pred gives the prediction with 50% rule, probabilities, and the computation of the</span><span class="sc0">
</span><span class="sc1"># coefficients multiplied by the predictors added together.  If above 0 then predict positive class for 2 class.</span><span class="sc0">
</span><span class="sc1"># In multi-class, the Bayes classifier assigns an observation to the class in which the equation is the largest.</span><span class="sc0">
</span><span class="sc3">sum</span><span class="sc8">(</span><span class="sc9">lda.pred</span><span class="sc8">$</span><span class="sc9">posterior</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">]&gt;</span><span class="sc5">.9</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Quadratic Discriminant Analysis</span><span class="sc0">
</span><span class="sc1"># implemented identical to lda in R</span><span class="sc0">
</span><span class="sc9">qda.fit</span><span class="sc8">=</span><span class="sc9">qda</span><span class="sc8">(</span><span class="sc9">Direction</span><span class="sc8">~</span><span class="sc9">Lag1</span><span class="sc8">+</span><span class="sc9">Lag2</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Smarket</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">qda.fit</span><span class="sc0">
</span><span class="sc1"># predict works the same as lda</span><span class="sc0">
</span><span class="sc9">qda.class</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">qda.fit</span><span class="sc0">, </span><span class="sc9">Smarket.2005</span><span class="sc8">)$</span><span class="sc3">class</span><span class="sc0">
</span><span class="sc3">table</span><span class="sc8">(</span><span class="sc9">Direction.2005</span><span class="sc0">,</span><span class="sc9">qda.class</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">qda.class</span><span class="sc8">==</span><span class="sc9">Direction.2005</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## K-Nearest Neighbors</span><span class="sc0">
</span><span class="sc1"># Four inputs required for knn()</span><span class="sc0">
</span><span class="sc1"># train and test x, train response, and K</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc3">class</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">train.X</span><span class="sc8">=</span><span class="sc3">cbind</span><span class="sc8">(</span><span class="sc9">Lag1</span><span class="sc0">,</span><span class="sc9">Lag2</span><span class="sc8">)[</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">test.X</span><span class="sc8">=</span><span class="sc3">cbind</span><span class="sc8">(</span><span class="sc9">Lag1</span><span class="sc0">,</span><span class="sc9">Lag2</span><span class="sc8">)[!</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">train.Direction</span><span class="sc8">=</span><span class="sc9">Direction</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">knn.pred</span><span class="sc8">=</span><span class="sc4">knn</span><span class="sc8">(</span><span class="sc9">train.X</span><span class="sc0">,</span><span class="sc9">test.X</span><span class="sc0">,</span><span class="sc9">train.Direction</span><span class="sc0">,</span><span class="sc9">k</span><span class="sc8">=</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">Direction.2005</span><span class="sc0">,</span><span class="sc9">knn.pred</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Caravan Insurance Example</span><span class="sc0">
</span><span class="sc1"># 6% of pople purchased caravan insurance</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Caravan</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">attach</span><span class="sc8">(</span><span class="sc9">Caravan</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">Purchase</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc5">348</span><span class="sc8">/</span><span class="sc5">5822</span><span class="sc0">
</span><span class="sc9">standardized.X</span><span class="sc8">=</span><span class="sc3">scale</span><span class="sc8">(</span><span class="sc9">Caravan</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc8">-</span><span class="sc5">86</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">Caravan</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">Caravan</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">standardized.X</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">standardized.X</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc1"># split into training and test sets</span><span class="sc0">
</span><span class="sc9">test</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">1000</span><span class="sc0">
</span><span class="sc9">train.X</span><span class="sc8">=</span><span class="sc9">standardized.X</span><span class="sc8">[-</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">test.X</span><span class="sc8">=</span><span class="sc9">standardized.X</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">train.Y</span><span class="sc8">=</span><span class="sc9">Purchase</span><span class="sc8">[-</span><span class="sc9">test</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">test.Y</span><span class="sc8">=</span><span class="sc9">Purchase</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">knn.pred</span><span class="sc8">=</span><span class="sc4">knn</span><span class="sc8">(</span><span class="sc9">train.X</span><span class="sc0">,</span><span class="sc9">test.X</span><span class="sc0">,</span><span class="sc9">train.Y</span><span class="sc0">,</span><span class="sc9">k</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc8">!=</span><span class="sc9">knn.pred</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc8">!=</span><span class="sc6">"No"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">knn.pred2</span><span class="sc8">=</span><span class="sc4">knn</span><span class="sc8">(</span><span class="sc9">train.X</span><span class="sc0">,</span><span class="sc9">test.X</span><span class="sc0">,</span><span class="sc9">train.Y</span><span class="sc0">,</span><span class="sc9">k</span><span class="sc8">=</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">knn.pred3</span><span class="sc8">=</span><span class="sc4">knn</span><span class="sc8">(</span><span class="sc9">train.X</span><span class="sc0">,</span><span class="sc9">test.X</span><span class="sc0">,</span><span class="sc9">train.Y</span><span class="sc0">,</span><span class="sc9">k</span><span class="sc8">=</span><span class="sc5">5</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># Diagnostic tabs</span><span class="sc0">
</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc0">,</span><span class="sc9">knn.pred</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc0">,</span><span class="sc9">knn.pred2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc0">,</span><span class="sc9">knn.pred3</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Using Logistic Regression on the Caravan Dataset</span><span class="sc0">
</span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">Purchase</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Caravan</span><span class="sc0">,</span><span class="sc3">family</span><span class="sc8">=</span><span class="sc3">binomial</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=-</span><span class="sc9">test</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.probs</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc0">,</span><span class="sc9">Caravan</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"response"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.pred</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc6">"No"</span><span class="sc0">,</span><span class="sc5">1000</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.pred</span><span class="sc8">[</span><span class="sc9">glm.probs</span><span class="sc8">&gt;</span><span class="sc5">.5</span><span class="sc8">]=</span><span class="sc6">"Yes"</span><span class="sc0">
</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc0">,</span><span class="sc9">glm.pred</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.pred2</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc6">"No"</span><span class="sc0">,</span><span class="sc5">1000</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.pred2</span><span class="sc8">[</span><span class="sc9">glm.probs</span><span class="sc8">&gt;</span><span class="sc5">.25</span><span class="sc8">]=</span><span class="sc6">"Yes"</span><span class="sc0">
</span><span class="sc9">printDiagnosticTable2Class</span><span class="sc8">(</span><span class="sc9">test.Y</span><span class="sc0">,</span><span class="sc9">glm.pred2</span><span class="sc8">)</span><span class="sc0">



</span><span class="sc1">## Validation Set Approach</span><span class="sc0">
</span><span class="sc1"># Good idea to use set.seed() with CV due to randomness</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">ISLR</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">train</span><span class="sc8">=</span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc5">392</span><span class="sc0">,</span><span class="sc5">196</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1">#hist(train)</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc0">
</span><span class="sc3">attach</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">mpg</span><span class="sc8">-</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc0">,</span><span class="sc9">Auto</span><span class="sc8">))[-</span><span class="sc9">train</span><span class="sc8">]^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># 26.14</span><span class="sc0">
</span><span class="sc9">lm.fit2</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc3">poly</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">mpg</span><span class="sc8">-</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit2</span><span class="sc0">,</span><span class="sc9">Auto</span><span class="sc8">))[-</span><span class="sc9">train</span><span class="sc8">]^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lm.fit3</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc3">poly</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">mpg</span><span class="sc8">-</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lm.fit3</span><span class="sc0">,</span><span class="sc9">Auto</span><span class="sc8">))[-</span><span class="sc9">train</span><span class="sc8">]^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Leave-One-Out Cross-Validations</span><span class="sc0">
</span><span class="sc1"># glm() without family=binomial does lm()</span><span class="sc0">
</span><span class="sc1"># There is cv.glm() available that does LOOCV</span><span class="sc0">
</span><span class="sc1"># Use the boot library for cv.glm()</span><span class="sc0">
</span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">glm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lm.fit</span><span class="sc8">=</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">lm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc4">boot</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">cv.err</span><span class="sc8">=</span><span class="sc9">cv.glm</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc9">glm.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">cv.err</span><span class="sc8">$</span><span class="sc9">delta</span><span class="sc0"> </span><span class="sc1"># (1/n) * Summation of MSE from LOOCV</span><span class="sc0">
</span><span class="sc1"># Iterate five times</span><span class="sc0">
</span><span class="sc9">cv.error</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc5">0</span><span class="sc0">,</span><span class="sc5">5</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc2">for</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">i</span><span class="sc0"> </span><span class="sc2">in</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">5</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
  </span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc3">poly</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc9">i</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">cv.error</span><span class="sc8">[</span><span class="sc9">i</span><span class="sc8">]=</span><span class="sc9">cv.glm</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc9">glm.fit</span><span class="sc8">)$</span><span class="sc9">delta</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">
</span><span class="sc9">cv.error</span><span class="sc0">

</span><span class="sc1">## k-Fold Cross-Validation</span><span class="sc0">
</span><span class="sc1"># cv.glm() can be used to implement k-fold CV</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">17</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">cv.error.10</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc5">0</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc2">for</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">i</span><span class="sc0"> </span><span class="sc2">in</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
  </span><span class="sc9">glm.fit</span><span class="sc8">=</span><span class="sc3">glm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc3">poly</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc9">i</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">cv.error.10</span><span class="sc8">[</span><span class="sc9">i</span><span class="sc8">]=</span><span class="sc9">cv.glm</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc9">glm.fit</span><span class="sc0">,</span><span class="sc9">K</span><span class="sc8">=</span><span class="sc5">10</span><span class="sc8">)$</span><span class="sc9">delta</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">]</span><span class="sc0">
  </span><span class="sc1"># for k-Fold CV the first $delta is the regular value,</span><span class="sc0">
  </span><span class="sc1"># the second $delta is the bias adjusted value</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">
</span><span class="sc9">cv.error.10</span><span class="sc0">

</span><span class="sc1">## Bootstrap</span><span class="sc0">
</span><span class="sc1"># Two steps: </span><span class="sc0">
</span><span class="sc1"># 1) Create a function that computers the statistics of interest</span><span class="sc0">
</span><span class="sc1"># 2) Use the boot() function in the boot library</span><span class="sc0">
</span><span class="sc9">alpha.fn</span><span class="sc8">=</span><span class="sc2">function</span><span class="sc8">(</span><span class="sc3">data</span><span class="sc0">,</span><span class="sc9">index</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc9">X</span><span class="sc8">=</span><span class="sc3">data</span><span class="sc8">$</span><span class="sc9">X</span><span class="sc8">[</span><span class="sc9">index</span><span class="sc8">]</span><span class="sc0">
  </span><span class="sc9">Y</span><span class="sc8">=</span><span class="sc3">data</span><span class="sc8">$</span><span class="sc9">Y</span><span class="sc8">[</span><span class="sc9">index</span><span class="sc8">]</span><span class="sc0">
  </span><span class="sc3">return</span><span class="sc8">((</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">Y</span><span class="sc8">)-</span><span class="sc3">cov</span><span class="sc8">(</span><span class="sc9">X</span><span class="sc0">,</span><span class="sc9">Y</span><span class="sc8">))/(</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">X</span><span class="sc8">)+</span><span class="sc3">var</span><span class="sc8">(</span><span class="sc9">Y</span><span class="sc8">)-</span><span class="sc5">2</span><span class="sc8">*</span><span class="sc3">cov</span><span class="sc8">(</span><span class="sc9">X</span><span class="sc0">,</span><span class="sc9">Y</span><span class="sc8">)))</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">
</span><span class="sc9">alpha.fn</span><span class="sc8">(</span><span class="sc9">Portfolio</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">100</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># we could run this command many times but boot automates it</span><span class="sc0">
</span><span class="sc1"># something like: alpha.fn(Portfolio,sample(100,100,replace=T))</span><span class="sc0">
</span><span class="sc4">boot</span><span class="sc8">(</span><span class="sc9">Portfolio</span><span class="sc0">,</span><span class="sc9">alpha.fn</span><span class="sc0">,</span><span class="sc9">R</span><span class="sc8">=</span><span class="sc5">1000</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1">###</span><span class="sc0">
</span><span class="sc1"># Shows original, std. error is SE(alpha); bias isn't explained.</span><span class="sc0">
</span><span class="sc9">boot.fn</span><span class="sc8">=</span><span class="sc2">function</span><span class="sc8">(</span><span class="sc3">data</span><span class="sc0">,</span><span class="sc9">index</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">return</span><span class="sc8">(</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc3">data</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">index</span><span class="sc8">)))</span><span class="sc0">
</span><span class="sc9">boot.fn</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">392</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">boot.fn</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc5">392</span><span class="sc0">,</span><span class="sc5">392</span><span class="sc0">,</span><span class="sc3">replace</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc9">boot.fn</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc5">392</span><span class="sc0">,</span><span class="sc5">392</span><span class="sc0">,</span><span class="sc3">replace</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc4">boot</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc9">boot.fn</span><span class="sc0">,</span><span class="sc5">1000</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1">### Bootstrap estimate</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">))</span><span class="sc0"> </span><span class="sc1"># Standard way</span><span class="sc0">
</span><span class="sc9">boot.fn</span><span class="sc8">=</span><span class="sc2">function</span><span class="sc8">(</span><span class="sc3">data</span><span class="sc0">,</span><span class="sc9">index</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">coefficients</span><span class="sc8">(</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc8">+</span><span class="sc9">I</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc8">^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc3">data</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">index</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc4">boot</span><span class="sc8">(</span><span class="sc9">Auto</span><span class="sc0">,</span><span class="sc9">boot.fn</span><span class="sc0">,</span><span class="sc5">1000</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">mpg</span><span class="sc8">~</span><span class="sc9">horsepower</span><span class="sc8">+</span><span class="sc9">I</span><span class="sc8">(</span><span class="sc9">horsepower</span><span class="sc8">^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Auto</span><span class="sc8">))</span><span class="sc0"> </span><span class="sc1"># Standard way</span><span class="sc0">


</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">ISLR</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">sum</span><span class="sc8">(</span><span class="sc9">is.na</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">$</span><span class="sc9">Salary</span><span class="sc8">))</span><span class="sc0"> </span><span class="sc1"># Finds count of missing values</span><span class="sc0">
</span><span class="sc1"># na.omit() function removes missing values</span><span class="sc0">
</span><span class="sc9">Hitters</span><span class="sc8">=</span><span class="sc9">na.omit</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">head</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">row.names</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">sum</span><span class="sc8">(</span><span class="sc9">is.na</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">))</span><span class="sc0">

</span><span class="sc1">## Best Subset Selection</span><span class="sc0">
</span><span class="sc1"># regsubsets() in the leaps library works like lm()</span><span class="sc0">
</span><span class="sc1"># but finds the best subset for K predictors</span><span class="sc0">
</span><span class="sc1"># install.packages("leaps")</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">leaps</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">regfit.full</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># By default stops at 8 predictors</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">regfit.full</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">19</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># sets 19 predictors as the maximum</span><span class="sc0">
</span><span class="sc9">reg.summary</span><span class="sc8">=</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">reg.summary</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">rsq</span><span class="sc0">
</span><span class="sc3">par</span><span class="sc8">(</span><span class="sc9">mfrow</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">rss</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"Number of Variables"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"RSS"</span><span class="sc0">,
     </span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"l"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">adjr2</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"Number of Variables"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"Adjusted RSq"</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"l"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># points() puts point on an existing plot</span><span class="sc0">
</span><span class="sc9">which.max</span><span class="sc8">(</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">adjr2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">points</span><span class="sc8">(</span><span class="sc5">11</span><span class="sc0">,</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">adjr2</span><span class="sc8">[</span><span class="sc5">11</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc0">,</span><span class="sc9">cex</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc9">pch</span><span class="sc8">=</span><span class="sc5">20</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">which.min</span><span class="sc8">(</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">bic</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">bic</span><span class="sc0">,</span><span class="sc9">xlab</span><span class="sc8">=</span><span class="sc6">"Number of Variables"</span><span class="sc0">,</span><span class="sc9">ylab</span><span class="sc8">=</span><span class="sc6">"BIC"</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"l"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">points</span><span class="sc8">(</span><span class="sc5">6</span><span class="sc0">,</span><span class="sc9">reg.summary</span><span class="sc8">$</span><span class="sc9">bic</span><span class="sc8">[</span><span class="sc5">6</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc0">,</span><span class="sc9">cex</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc9">pch</span><span class="sc8">=</span><span class="sc5">20</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># This library has a built in plot function that is nice</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc6">"r2"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc6">"adjr2"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc6">"Cp"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc6">"bic"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc8">?</span><span class="sc9">plot.regsubsets</span><span class="sc0">
</span><span class="sc1"># Use coef() to get the estimates for a given fit</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc0">,</span><span class="sc5">6</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Forward and Backward Selection</span><span class="sc0">
</span><span class="sc1"># We can also use regsubsets() to use forward or backwards stepwise selection</span><span class="sc0">
</span><span class="sc9">regfit.fwd</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">10</span><span class="sc0">,</span><span class="sc9">method</span><span class="sc8">=</span><span class="sc6">"forward"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">regfit.fwd</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">regfit.bwd</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">10</span><span class="sc0">,</span><span class="sc9">method</span><span class="sc8">=</span><span class="sc6">"backward"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">regfit.bwd</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># For 7 predictors, the best subsets differs from the stepwise predictors</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.full</span><span class="sc0">,</span><span class="sc5">7</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.fwd</span><span class="sc0">,</span><span class="sc5">7</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.bwd</span><span class="sc0">,</span><span class="sc5">7</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Choosing among models - Validation Set</span><span class="sc0">
</span><span class="sc1"># Validation Set</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">train</span><span class="sc8">=</span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc2">TRUE</span><span class="sc0">,</span><span class="sc2">FALSE</span><span class="sc8">)</span><span class="sc0">, </span><span class="sc3">nrow</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">rep</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">test</span><span class="sc8">=(!</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">regfit.best</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">19</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">test.mat</span><span class="sc8">=</span><span class="sc9">model.matrix</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">])</span><span class="sc0"> </span><span class="sc1"># builds an X matrix from data holding coefficients</span><span class="sc0">
</span><span class="sc1"># from models of difference sizes.  We extract these.</span><span class="sc0">
</span><span class="sc9">val.errors</span><span class="sc8">=</span><span class="sc3">rep</span><span class="sc8">(</span><span class="sc2">NA</span><span class="sc0">,</span><span class="sc5">19</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc2">for</span><span class="sc8">(</span><span class="sc9">i</span><span class="sc0"> </span><span class="sc2">in</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">19</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc9">coefi</span><span class="sc8">=</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.best</span><span class="sc0">,</span><span class="sc9">id</span><span class="sc8">=</span><span class="sc9">i</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">pred</span><span class="sc8">=</span><span class="sc9">test.mat</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">coefi</span><span class="sc8">)]</span><span class="sc10">%*%</span><span class="sc9">coefi</span><span class="sc0"> </span><span class="sc1"># Multiplies the coefficients and adds them (Matrix Multiplication)</span><span class="sc0">
  </span><span class="sc9">val.errors</span><span class="sc8">[</span><span class="sc9">i</span><span class="sc8">]=</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">Hitters</span><span class="sc8">$</span><span class="sc9">Salary</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc8">]-</span><span class="sc9">pred</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">
</span><span class="sc9">which.min</span><span class="sc8">(</span><span class="sc9">val.errors</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># 10 predictors is the best model found</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.best</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># This was a bit tedious because predict() isn't available, we can create a function for future use.</span><span class="sc0">
</span><span class="sc1"># Creating our own predict function:</span><span class="sc0">
</span><span class="sc9">predict.regsubsets</span><span class="sc8">=</span><span class="sc2">function</span><span class="sc8">(</span><span class="sc9">object</span><span class="sc0">,</span><span class="sc9">newdata</span><span class="sc0">,</span><span class="sc9">id</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc9">form</span><span class="sc8">=</span><span class="sc9">as.formula</span><span class="sc8">(</span><span class="sc9">object</span><span class="sc8">$</span><span class="sc3">call</span><span class="sc8">[[</span><span class="sc5">2</span><span class="sc8">]])</span><span class="sc0"> </span><span class="sc1"># Extracting the formula</span><span class="sc0">
  </span><span class="sc9">mat</span><span class="sc8">=</span><span class="sc9">model.matrix</span><span class="sc8">(</span><span class="sc9">form</span><span class="sc0">,</span><span class="sc9">newdata</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">coefi</span><span class="sc8">=</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">object</span><span class="sc0">,</span><span class="sc9">id</span><span class="sc8">=</span><span class="sc9">id</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">xvars</span><span class="sc8">=</span><span class="sc3">names</span><span class="sc8">(</span><span class="sc9">coefi</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">mat</span><span class="sc8">[</span><span class="sc0">,</span><span class="sc9">xvars</span><span class="sc8">]</span><span class="sc10">%*%</span><span class="sc9">coefi</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">
</span><span class="sc1"># Once you choose the best model (10 predictors in this case), always fit for coefficients on the full dataset</span><span class="sc0">
</span><span class="sc9">regfit.best</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">19</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">regfit.best</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Choosing among models - Cross Validation</span><span class="sc0">
</span><span class="sc1"># This approach is somewhat involved; we do best subset selection within each k folds</span><span class="sc0">
</span><span class="sc1"># First allocate observations to the 10 folds</span><span class="sc0">
</span><span class="sc9">k</span><span class="sc8">=</span><span class="sc5">10</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">folds</span><span class="sc8">=</span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc9">k</span><span class="sc0">,</span><span class="sc3">nrow</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">,</span><span class="sc3">replace</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">cv.errors</span><span class="sc8">=</span><span class="sc3">matrix</span><span class="sc8">(</span><span class="sc2">NA</span><span class="sc0">,</span><span class="sc9">k</span><span class="sc0">,</span><span class="sc5">19</span><span class="sc0">, </span><span class="sc3">dimnames</span><span class="sc8">=</span><span class="sc3">list</span><span class="sc8">(</span><span class="sc2">NULL</span><span class="sc0">, </span><span class="sc3">paste</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">19</span><span class="sc8">)))</span><span class="sc0">

</span><span class="sc2">for</span><span class="sc8">(</span><span class="sc9">j</span><span class="sc0"> </span><span class="sc2">in</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc8">:</span><span class="sc9">k</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc9">best.fit</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc8">[</span><span class="sc9">folds</span><span class="sc8">!=</span><span class="sc9">j</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">19</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc2">for</span><span class="sc8">(</span><span class="sc9">i</span><span class="sc0"> </span><span class="sc2">in</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">19</span><span class="sc8">){</span><span class="sc0">
    </span><span class="sc9">pred</span><span class="sc8">=</span><span class="sc9">predict.regsubsets</span><span class="sc8">(</span><span class="sc9">best.fit</span><span class="sc0">,</span><span class="sc9">Hitters</span><span class="sc8">[</span><span class="sc9">folds</span><span class="sc8">==</span><span class="sc9">j</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">id</span><span class="sc8">=</span><span class="sc9">i</span><span class="sc8">)</span><span class="sc0">
    </span><span class="sc9">cv.errors</span><span class="sc8">[</span><span class="sc9">j</span><span class="sc0">,</span><span class="sc9">i</span><span class="sc8">]=</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">$</span><span class="sc9">Salary</span><span class="sc8">[</span><span class="sc9">folds</span><span class="sc8">==</span><span class="sc9">j</span><span class="sc8">]-</span><span class="sc9">pred</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc8">}</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">
</span><span class="sc1"># 10 x 19 matrix, where you have 19 flexibilities and 10 folds.  </span><span class="sc0">
</span><span class="sc9">cv.errors</span><span class="sc0"> 
</span><span class="sc1"># We want 1 x 19 so we use apply()</span><span class="sc0">
</span><span class="sc9">mean.cv.errors</span><span class="sc8">=</span><span class="sc3">apply</span><span class="sc8">(</span><span class="sc9">cv.errors</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc3">mean</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">mean.cv.errors</span><span class="sc0">
</span><span class="sc3">par</span><span class="sc8">(</span><span class="sc9">mfrow</span><span class="sc8">=</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">1</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">mean.cv.errors</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc7">'b'</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">which.min</span><span class="sc8">(</span><span class="sc9">mean.cv.errors</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">points</span><span class="sc8">(</span><span class="sc5">11</span><span class="sc0">,</span><span class="sc9">mean.cv.errors</span><span class="sc8">[</span><span class="sc5">11</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc3">col</span><span class="sc8">=</span><span class="sc6">"red"</span><span class="sc0">,</span><span class="sc9">cex</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc9">pch</span><span class="sc8">=</span><span class="sc5">20</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># We now want to now get coefficients for the 11 predictor model on all the data</span><span class="sc0">
</span><span class="sc9">reg.best</span><span class="sc8">=</span><span class="sc9">regsubsets</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">, </span><span class="sc9">nvmax</span><span class="sc8">=</span><span class="sc5">19</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">reg.best</span><span class="sc0">,</span><span class="sc5">11</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Ridge Regression and the Lasso</span><span class="sc0">
</span><span class="sc1"># glmnet package can perform ridge regression and lasso.  glmnet() is the main function in the package</span><span class="sc0">
</span><span class="sc1"># glmnet is also good in that it converts qualitative variables into dummy variables (also input must be numeric or these dummy qualitative values)</span><span class="sc0">
</span><span class="sc1"># install.packages("glmnet")</span><span class="sc0">
</span><span class="sc1"># MSE with one set</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">glmnet</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">Hitters</span><span class="sc8">=</span><span class="sc9">na.omit</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc9">Hitters</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># model.matrix is important</span><span class="sc0">
</span><span class="sc9">x</span><span class="sc8">=</span><span class="sc9">model.matrix</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc9">Hitters</span><span class="sc8">)[</span><span class="sc0">,</span><span class="sc8">-</span><span class="sc5">1</span><span class="sc8">]</span><span class="sc0"> </span><span class="sc1"># Removes intercept</span><span class="sc0">
</span><span class="sc9">y</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc8">$</span><span class="sc9">Salary</span><span class="sc0">
</span><span class="sc1"># alpha=0 is ridge regression model fit; alpha=1 is lasso model fit</span><span class="sc0">
</span><span class="sc3">grid</span><span class="sc8">=</span><span class="sc5">10</span><span class="sc8">^</span><span class="sc3">seq</span><span class="sc8">(</span><span class="sc5">10</span><span class="sc0">,</span><span class="sc8">-</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc3">length</span><span class="sc8">=</span><span class="sc5">100</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">ridge.mod</span><span class="sc8">=</span><span class="sc9">glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">0</span><span class="sc0">,</span><span class="sc9">lambda</span><span class="sc8">=</span><span class="sc3">grid</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># grid is generated by default, but we use it in the lab</span><span class="sc0">
</span><span class="sc1"># by default standardize=TRUE for glmnet()</span><span class="sc0">
</span><span class="sc3">dim</span><span class="sc8">(</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc8">))</span><span class="sc0"> </span><span class="sc1"># 20 x 100.  p=20, lambda values vector is length 100 (one value per lambda)</span><span class="sc0">
</span><span class="sc1"># We expect low coefficients when the lambda (part of the penalty term) is large</span><span class="sc0">
</span><span class="sc9">ridge.mod</span><span class="sc8">$</span><span class="sc9">lambda</span><span class="sc8">[</span><span class="sc5">50</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc8">)[</span><span class="sc0">,</span><span class="sc5">50</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">sqrt</span><span class="sc8">(</span><span class="sc3">sum</span><span class="sc8">(</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc8">)[-</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">50</span><span class="sc8">]^</span><span class="sc5">2</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc1"># lambda at index 60 is smaller, so coefficients are larger</span><span class="sc0">
</span><span class="sc9">ridge.mod</span><span class="sc8">$</span><span class="sc9">lambda</span><span class="sc8">[</span><span class="sc5">60</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc8">)[</span><span class="sc0">,</span><span class="sc5">60</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc3">sqrt</span><span class="sc8">(</span><span class="sc3">sum</span><span class="sc8">(</span><span class="sc3">coef</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc8">)[-</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">60</span><span class="sc8">]^</span><span class="sc5">2</span><span class="sc8">))</span><span class="sc0">
</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc5">50</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"coefficients"</span><span class="sc8">)[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">20</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0"> </span><span class="sc1"># gets coefficients</span><span class="sc0">

</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">train</span><span class="sc8">=</span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc3">nrow</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">)</span><span class="sc0">, </span><span class="sc3">nrow</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">)/</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># random sample w/o replacement</span><span class="sc0">
</span><span class="sc9">test</span><span class="sc8">=(-</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">y.test</span><span class="sc8">=</span><span class="sc9">y</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc1"># predicting MSE on a test set</span><span class="sc0">
</span><span class="sc1"># get coef w/ x, y, ridge regression, grid, and thresh.</span><span class="sc0">
</span><span class="sc9">ridge.mod</span><span class="sc8">=</span><span class="sc9">glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">0</span><span class="sc0">,</span><span class="sc9">lambda</span><span class="sc8">=</span><span class="sc3">grid</span><span class="sc0">,</span><span class="sc9">thresh</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc9">e</span><span class="sc8">-</span><span class="sc5">12</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">ridge.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc5">4</span><span class="sc0">,</span><span class="sc9">newx</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">ridge.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc3">mean</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc8">])-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># MSE if we predict mean y of training set</span><span class="sc0">
</span><span class="sc1"># We could get a similar MSE with a large lambda value (part of penalty term)</span><span class="sc0">
</span><span class="sc9">ridge.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc9">e10</span><span class="sc0">,</span><span class="sc9">newx</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">])</span><span class="sc0"> </span><span class="sc1"># predicts test set values</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">ridge.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># Recall that least squares is simply ridge regression with lambda = 0</span><span class="sc0">
</span><span class="sc9">ridge.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc5">0</span><span class="sc0">,</span><span class="sc9">newx</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">exact</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">ridge.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">lm</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">~</span><span class="sc9">x</span><span class="sc0">, </span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc5">0</span><span class="sc0">,</span><span class="sc9">exact</span><span class="sc8">=</span><span class="sc9">T</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"coefficients"</span><span class="sc8">)[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">20</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">

</span><span class="sc1"># It's better to use CV to choose lambda; cv.glmnet() is built in to do this.</span><span class="sc0">
</span><span class="sc1"># by default 10 folds are used</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">cv.out</span><span class="sc8">=</span><span class="sc9">cv.glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">0</span><span class="sc8">)</span><span class="sc0">  </span><span class="sc1">## Very good as quick Cross Validation!</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cv.out</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">bestlam</span><span class="sc8">=</span><span class="sc9">cv.out</span><span class="sc8">$</span><span class="sc9">lambda.min</span><span class="sc0">
</span><span class="sc9">bestlam</span><span class="sc0">
</span><span class="sc9">ridge.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">ridge.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc9">bestlam</span><span class="sc0">,</span><span class="sc9">newx</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">ridge.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">out</span><span class="sc8">=</span><span class="sc9">glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">0</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">out</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"coefficients"</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc9">bestlam</span><span class="sc8">)[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">20</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">

</span><span class="sc1">## The Lasso</span><span class="sc0">
</span><span class="sc1"># we use alpha=1 for lasso</span><span class="sc0">
</span><span class="sc9">lasso.mod</span><span class="sc8">=</span><span class="sc9">glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc9">lambda</span><span class="sc8">=</span><span class="sc3">grid</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">lasso.mod</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># We now use CV</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">cv.out</span><span class="sc8">=</span><span class="sc9">cv.glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc8">[</span><span class="sc9">train</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">plot</span><span class="sc8">(</span><span class="sc9">cv.out</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">bestlam</span><span class="sc8">=</span><span class="sc9">cv.out</span><span class="sc8">$</span><span class="sc9">lambda.min</span><span class="sc0">
</span><span class="sc9">lasso.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">lasso.mod</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc9">bestlam</span><span class="sc0">,</span><span class="sc9">newx</span><span class="sc8">=</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">])</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">lasso.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># 12 of the 19 coefficients are set to zero.</span><span class="sc0">
</span><span class="sc9">out</span><span class="sc8">=</span><span class="sc9">glmnet</span><span class="sc8">(</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc9">y</span><span class="sc0">,</span><span class="sc9">alpha</span><span class="sc8">=</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc9">lambda</span><span class="sc8">=</span><span class="sc3">grid</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">lasso.coef</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">out</span><span class="sc0">,</span><span class="sc9">type</span><span class="sc8">=</span><span class="sc6">"coefficients"</span><span class="sc0">,</span><span class="sc9">s</span><span class="sc8">=</span><span class="sc9">bestlam</span><span class="sc8">)[</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">20</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">
</span><span class="sc9">lasso.coef</span><span class="sc0">

</span><span class="sc1">## PCR</span><span class="sc0">
</span><span class="sc1"># uses pcr() function; pls library.  We use PCR to predict Salary</span><span class="sc0">
</span><span class="sc1"># be sure to remove the missing values</span><span class="sc0">
</span><span class="sc3">library</span><span class="sc8">(</span><span class="sc9">pls</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">pcr.fit</span><span class="sc8">=</span><span class="sc9">pcr</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">., </span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc0">,</span><span class="sc9">validation</span><span class="sc8">=</span><span class="sc6">"CV"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># pcr() function is similar to lm()</span><span class="sc0">
</span><span class="sc1"># scale=TRUE standardizes with xi &lt;- xi / sqrt(distance from the mean)</span><span class="sc0">
</span><span class="sc1"># validation="CV" causes pcr() to compute the ten-fold CV error</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">pcr.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># we can visualize this with a plot</span><span class="sc0">
</span><span class="sc9">validationplot</span><span class="sc8">(</span><span class="sc9">pcr.fit</span><span class="sc0">,</span><span class="sc9">val.type</span><span class="sc8">=</span><span class="sc6">"MSEP"</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc1"># MSEP is CV MSE</span><span class="sc0">

</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">pcr.fit</span><span class="sc8">=</span><span class="sc9">pcr</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc0">,</span><span class="sc9">validation</span><span class="sc8">=</span><span class="sc6">"CV"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">validationplot</span><span class="sc8">(</span><span class="sc9">pcr.fit</span><span class="sc0">,</span><span class="sc9">val.type</span><span class="sc8">=</span><span class="sc6">"MSEP"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">pcr.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">pcr.fit</span><span class="sc0">,</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">ncomp</span><span class="sc8">=</span><span class="sc5">7</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">pcr.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># This is competitive with ridge regression and lasso</span><span class="sc0">
</span><span class="sc1"># It is less interpretable because we don't have coefficients or variable selection with PCR</span><span class="sc0">
</span><span class="sc9">pcr.fit</span><span class="sc8">=</span><span class="sc9">pcr</span><span class="sc8">(</span><span class="sc9">y</span><span class="sc8">~</span><span class="sc9">x</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc0">,</span><span class="sc9">ncomp</span><span class="sc8">=</span><span class="sc5">7</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">pcr.fit</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc1">## Partial Least Squares (PLS) Regression</span><span class="sc0">
</span><span class="sc1"># plsr() of pls library</span><span class="sc0">
</span><span class="sc9">set.seed</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">pls.fit</span><span class="sc8">=</span><span class="sc9">plsr</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc3">subset</span><span class="sc8">=</span><span class="sc9">train</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc0">,</span><span class="sc9">validation</span><span class="sc8">=</span><span class="sc6">"CV"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">pls.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">validationplot</span><span class="sc8">(</span><span class="sc9">pls.fit</span><span class="sc0">,</span><span class="sc9">val.type</span><span class="sc8">=</span><span class="sc6">"MSEP"</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">pls.pred</span><span class="sc8">=</span><span class="sc3">predict</span><span class="sc8">(</span><span class="sc9">pls.fit</span><span class="sc0">,</span><span class="sc9">x</span><span class="sc8">[</span><span class="sc9">test</span><span class="sc0">,</span><span class="sc8">]</span><span class="sc0">,</span><span class="sc9">ncomp</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">mean</span><span class="sc8">((</span><span class="sc9">pls.pred</span><span class="sc8">-</span><span class="sc9">y.test</span><span class="sc8">)^</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">

</span><span class="sc9">pls.fit</span><span class="sc8">=</span><span class="sc9">plsr</span><span class="sc8">(</span><span class="sc9">Salary</span><span class="sc8">~</span><span class="sc0">.,</span><span class="sc3">data</span><span class="sc8">=</span><span class="sc9">Hitters</span><span class="sc0">,</span><span class="sc3">scale</span><span class="sc8">=</span><span class="sc2">TRUE</span><span class="sc0">,</span><span class="sc9">ncomp</span><span class="sc8">=</span><span class="sc5">2</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc3">summary</span><span class="sc8">(</span><span class="sc9">pls.fit</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc1"># PLS is a supervised alternative to PCR</span></div>

</body>
</html>
